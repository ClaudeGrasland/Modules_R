---
title: "Cartographie avec `mapsf`"
subtitle: "Présentation du package `mapsf` pour la cartographie thématique"
author: 
- Timothée Giraud
- Hugues pecout
date: last-modified
ordre: 01
code-fold: true
code-tools: true
---

:::{.callout-note}
Le support de ce cours est disponible en ligne. Il s'agit d'un manuel initialement conçu pour accompagner le cours *'Cartographie avec R'* du Master 2 Géomatique, géodécisionnel, géomarketing et multimédia (G2M) de l’Université Paris 8 Vincennes - Saint-Denis (France). 
Vous pouvez nous envoyer vos remarques et suggestions en [postant une issue](https://github.com/rCarto/cartographie_avec_r/issues) sur le [dépôt GitHub](https://github.com/rCarto/cartographie_avec_r) de ce document.
:::

\

::: center
<a href="https://rcarto.github.io/cartographie_avec_r/" class="btn btn-info" role="button" aria-disabled="true"><i class="bi bi-eye"></i> Cartographie avec R - Le package `mapsf`</a>
:::

\

## <i class="bi bi-person-workspace"></i> Exercice {.title .exo-title}

::: {#exo}
[1. Créez un projet Rstudio]{.question}

*File/New Project/New Directory...*

[2. Téléchargez les données suivantes :]{.question}

|             Intitulé              |                                                                     Téléchargement                                                                      |
|:-----------------------------------------:|:---------------------------:|
| Données pays africains (UN-CEPII) | <a href="https://bit.ly/3DaCAkX" class="btn btn-outline-warning" role="button" aria-disabled="true"><i class="bi bi-cloud-arrow-down"></i> Download</a> |
| Fond de carte Afrique (GADM 2020) | <a href="https://bit.ly/3DaAUb2" class="btn btn-outline-warning" role="button" aria-disabled="true"><i class="bi bi-cloud-arrow-down"></i> Download</a> |

[3. Placez les données (décompressées) dans le répertoire de votre projet, de la façon suivante :]{.question}

```{r, echo=FALSE, out.width="70%", fig.align='center'}
knitr::include_graphics("../img/folder3.png")
```

[4. Importez les fichiers suivants en utilisant les fonctions adéquates :]{.question}

-   data/DEV_AFRIA_2018/**afrika_don.csv**\
-   data/GADM_AFRICA_2020/**afrika_map.shp**\

```{r warning = FALSE, message = FALSE , eval = FALSE}
#| code-summary: "Un peu d'aide ?"
  
# Pour importer le fichier csv (afrika_don.csv)
read.csv()
read.csv2()

# Pour importer le fichier ESRI Shapefile (afrika_map.shp)
library(sf)
st_read()


```

[5. Faîte une jointure entre le fond de carte des pays et le tableau de données statistiques]{.question}

```{r warning = FALSE, message = FALSE , eval = FALSE}
#| code-summary: "Un peu d'aide ?"
  
# Jointure en R-base
merge() 

# Ou 
jointure avec le package dplyr
left_join()

```

[6. Construisez une carte thématique représentant la variable **POP** (nombre d'habitants)]{.question}

```{r warning = FALSE, message = FALSE , eval = FALSE}
#| code-summary: "Un peu d'aide ?"

# Créer une carte en symboles proportionnels
mf_map()
# OU
mf_prop()


```


[7. Construisez une thématique représentant la variable **INTERN** (part des utilisateurs d'internet dans la population totale)]{.question}

```{r warning = FALSE, message = FALSE , eval = FALSE}
#| code-summary: "Un peu d'aide ?"
  
# Créer une carte choroplèthe
mf_map()
# OU
mf_choro()

```


[8. Exportez ces deux cartes en format svg et png, à l'aide d'une fonction du package mapsf]{.question}

```{r warning = FALSE, message = FALSE , eval = FALSE}
#| code-summary: "Un peu d'aide ?"
  
mf_export()
dev.off()

```



[9.  Construisez une carte thématique représentant la variable **POP** ET la variable **INTERN**]{.question}

```{r warning = FALSE, message = FALSE , eval = FALSE}
#| code-summary: "Un peu d'aide ?"
  
# Créer une carte de stocks et de ratios
mf_map()
# OU
mf_prop_choro()

```


------------------------------------------------------------------------

\

::: center
<a href="/correction/cartographie_mapsf.zip" class="btn btn-outline-warning" role="button" aria-disabled="true"><i class="bi bi-cloud-arrow-down"></i> Corrigé</a>
:::

```{r warning = FALSE, message = FALSE , eval = FALSE, echo = FALSE, include = FALSE}
#| code-summary: "Correction"

##--------------------##  
## Import des données ##
##--------------------##

# Tableau csv
data <- read.csv2(file = "./data/DEV_AFRICA_2018/afrika_don.csv")

# ESRI shapefile (données géographiques)
library(sf)
basemap <- st_read("./data/GADM_AFRICA_2020/afrika_map.shp",  quiet = TRUE)


##----------##
## Jointure ##
##----------##

# R-base
data_map <- merge(basemap, data, by="iso3", all.x = TRUE)

# OU avec le package dplyr
library(dplyr)
data_map <-left_join(basemap, data, by = "iso3")



##----------------------------------##  
## Carte en symboles proportionnels ##
##----------------------------------##

library(mapsf)

# Initialisation de l'export de la carte (format svg)
mf_export(data_map, "Population_in_Afica_2020.svg", width = 100)

# Utilisation du thème darkula
mf_theme("darkula")

# Affichage du fond de carte (pays africains)
mf_map(data_map, col = "grey70", border = "black", lwd = 0.2)

# Affichage de cercles proportionnels (nombre d'habitants)
mf_map(x = data_map,
       var = "POP",
       symbol = "circle",
       type = "prop",
       inches = 0.40,
       col = "brown4",
       border = "white",
       lwd = 0.5,
       leg_pos = "bottomleft2",
       leg_title = "Nombre d'habitants (en millions)", 
       add = TRUE)

# Ajout d'un titre et des sources
mf_layout(title = "Répartition de la population en Afrique, 2020",
          credits = paste0("Sources: Human Development Report 2020\n",
                           "mapsf ", 
                           packageVersion("mapsf")))

# Enregistrement du fichier svg
dev.off()



##-------------------------------##  
## Carte choroplèthe avec Export ##
##-------------------------------##

# Visualisation de la forme de la distribution de la variable "INTERN" 
hist(data_map$INTERN)

# Initialisation de l'export de la carte
mf_export(data_map, "Internet_users_in_Afica_2020.png", width = 700)

# Utilisation du thème jsk
mf_theme("jsk")

# Initialisation d'une carte centré sur la couche géographique "data_map" (pays d'Afrique)
mf_init(x = data_map)

# Ajour d'un effet d'ombrage pour la couche "data_map"
mf_shadow(data_map, add = TRUE)

# Ajout d'un aplat de couleur en fonction de la valeur de "INTERN"
mf_map(x = data_map,
       var = "INTERN",
       type = "choro",
       breaks = "quantile",  # Discrétisation par quantiles
       nbreaks = 6,          # En 6 classes
       pal = "Greens",       # Palette de couleur verte
       leg_val_rnd = 1, 
       border = "grey50",
       lwd = 0.5,
       col_na = "grey80",
       leg_pos = "topright",
       leg_title = "Part des utilisateurs (%)",
       add = TRUE)

# Ajout d'étiquettes pour chaque pays
mf_label(x = data_map, 
         var = "name.x", 
         col = "grey10", 
         cex = 0.5,
         overlap = FALSE,          
         bg = "white",
         halo = TRUE, 
         lines = FALSE)

# Ajout d'un titre et des sources
mf_layout(title = "L'utilisation d'internet en Afrique, 2020",
          credits = paste0("Sources: Human Development Report 2020\n",
                           "mapsf ",
                           packageVersion("mapsf")))

# Enregistrement du fichier png
dev.off()





```
:::

\
